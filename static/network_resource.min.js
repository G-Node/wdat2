var wdat;(function(a){"use strict",a.NetworkResource=function(){function b(){this._xhr=new XMLHttpRequest}return b.prototype.get=function(a){var b;if(a instanceof Array&&a.length>0){var c=[];for(var d in a)a[d].hasOwnProperty("depth")&&(a[d].depth&&(b=parseInt(a[d].depth)),delete a[d].depth);for(var d in a){var e=this._getSingle(a[d],b);if(e.error&&e.status!=404){c=[e];break}c.push(e)}var f=c.pop();if(!f.error){f.response.selected||(f.response.selected=[]);for(var d in c){var e=c[d];!e.error&&e.response.selected&&(f.response.selected=f.response.selected.concat(e.response.selected))}}return f}if(typeof a=="object")return a.hasOwnProperty("depth")&&(a.depth&&(b=parseInt(a.depth)),delete a.depth),this._getSingle(a,b)},b.prototype.getByURL=function(a){var b={url:a};this._xhr.open("GET",a,!1),this._xhr.send();if(this._xhr.status==200)b.status=200,b.response=JSON.parse(this._xhr.responseText);else if(this._xhr.status==500)b.status=this._xhr.status,b.error=!0,b.response="Internal server error (500)";else if(this._xhr.status==404)b.status=this._xhr.status,b.error=!0,b.response="Not found (404)";else{b.status=this._xhr.status,b.error=!0;var c=JSON.parse(this._xhr.responseText);b.response=c.details||c.message||"Error during request: ("+this._xhr.status+")"}return b},b.prototype.setByURL=function(a,b){var c={url:a};this._xhr.open("POST",a,!1),this._xhr.send(JSON.stringify(b));if(this._xhr.status===200||this._xhr.status===201)c.status=this._xhr.status,c.response=JSON.parse(this._xhr.responseText);else if(this._xhr.status==500)c.status=this._xhr.status,c.error=!0,c.response="Internal server error (500)";else if(this._xhr.status==404)c.status=this._xhr.status,c.error=!0,c.response="Not found (404)";else{c.status=this._xhr.status,c.error=!0;var d=JSON.parse(this._xhr.responseText);c.response=d.details||d.message||"Error during request: ("+this._xhr.status+")"}return c},b.prototype.delByURL=function(a){var b=a;!strStartsWith(a,"http://")&&!strStartsWith(a,"/")&&(b="/"+a);var c={url:b};this._xhr.open("DELETE",b,!1),this._xhr.send();if(this._xhr.status===200){c.status=200;var d=JSON.parse(this._xhr.responseText);c.response=d.message}else if(this._xhr.status==500)c.status=this._xhr.status,c.error=!0,c.response="Internal server error (500)";else if(this._xhr.status==404)c.status=this._xhr.status,c.error=!0,c.response="Not found (404)";else{c.status=this._xhr.status,c.error=!0;var e=JSON.parse(this._xhr.responseText);c.response=e.details||e.message||"Error during request: ("+this._xhr.status+")"}return c},b.prototype._getSingle=function(b,c){var d=null;if(c){var e=c>2?2:c,f=this._specToURL(b);d=this.getByURL(f);if(!d.error){var g=d.response,h=!1,i=[],j=[];for(var k in g.selected)j.push({data:g.selected[k],depth:0});while(j.length>0&&!h){var l=j.pop();if(l.depth<e){var m=l.data.model.split(".");m=m[m.length-1];var n=a.modelChildren(m),o=a.stripURL(l.data.permalink);for(var k in n){var p=n[k];if(p.type&&p.type!=m&&l.data.fields[k].length>0){var q=this.get({type:p.type,parent:o});if(!!q.error){h=q.response;break}var r=q.response;i.push(r);for(var s in r.selected)l.depth+1<e&&j.push({data:r.selected[s],depth:l.depth+1})}}}}if(!h){for(var k in i){var t=i[k];g.selected=g.selected.concat(t.selected)}d.response=g}else d.response=h,d.error=!0}}else{var f=this._specToURL(b);d=this.getByURL(f)}return d},b.prototype._specToURL=function(b){var c;if(b.id||b.permalink){b.permalink&&(b.id=b.permalink);var d=b.id.toString().split("/"),e=[];for(var f in d)d[f]&&d[f]!=""&&e.push(d[f]);d=e,d.length===3&&(b.category=d[0],b.type=d[1],b.id=d[2]),b.category||(b.category=a.modelCategory(b.type)),c="/"+b.category+"/"+b.type+"/"+b.id+"?q=full"}else{b.category||(b.category=a.modelCategory(b.type)),c="/"+b.category+"/"+b.type+"/?q=full&";for(var f in b)if(f!=="type"&&f!=="category"){var g=f,h,i;b[f]instanceof Array?b[f].length>1?(h=b[f][0],i=b[f][1]):(b[f].length=1)?(h=b[f][0],i="="):(h="",i="="):(h=b[f],i="="),c+=this._specToComp(b.type,g,h,i)}}return"http://"+location.hostname+":"+location.port+c},b.prototype._specToComp=function(b,c,d,e){var f="",g=a.modelTemplate(b),h=a.modelFields(b),i=function(a){switch(a){case">":return"__gt=";case"<":return"__le=";default:if(h[c]&&h[c].type){var b=h[c].type;if(b=="int"||b=="num")return"__exact="}return"__icontains="}};switch(c){case"category":break;case"type":break;case"parent":var j=d.toString().split("/"),k=[];for(var l in j)j[l]&&j[l]!=""&&k.push(j[l]);j=k;if(j.length===3){var m=j[1],n=j[2],o;for(var l in g.parents)if(l.match(m)){o=l;break}o&&(f=encodeURIComponent(o)+"="+encodeURIComponent(n)+"&")}else{f="";if(!d||vlaue=="")for(var l in g.parents)f+=encodeURIComponent(l)+"__isnull=1&"}break;case"safety_level":var p=parseInt(d);if(!p>0)switch(d){case"public":p=1;break;case"friendly":p=2;break;default:p=3}f=encodeURIComponent(c)+"__exact="+encodeURIComponent(p)+"&";break;case"owner":if(d!=null&&d!=undefined&&d!==""){var q=d.toString().split("/").pop();f=encodeURIComponent(c)+"__exact="+encodeURIComponent(q)+"&"}else f=encodeURIComponent(c)+"__isnull=1&";break;default:var r=i(e);d!=null&&d!=undefined&&d!==""?f=encodeURIComponent(c)+r+encodeURIComponent(d)+"&":f=encodeURIComponent(c)+"__isnull=1&"}return e=="!="&&(f="n__"+f),f},b}(),a.ResourceAdapter=function(){function b(){}return b.prototype.adapt=function(b){var c={},d=b;typeof d=="string"&&(d=JSON.parse(d));for(var e in d.selected){var f=d.selected[e],g={},h=a.stripURL(f.permalink).split("/");g.id=h.join("/"),g.type=h[1],g.category=a.modelCategory(g.type),g.plotable=a.isPlotable(g.type),g.date_created=f.fields.date_created,g.owner=a.stripURL(f.fields.owner);switch(f.fields.safety_level){case 1:g.safety_level="public";break;case 2:g.safety_level="friendly";break;default:g.safety_level="private"}var i=a.modelTemplate(g.type);if(i){g.fields={};for(var j in i.fields)j==="name"?g.type==="value"?g.name=f.fields.data:g.name=f.fields.name:g.fields[j]=f.fields[j];g.children={};for(var k in i.children)if(f.fields[k]&&f.fields[k].length>0){g.children[k]=[];for(var l in f.fields[k])g.children[k][l]=a.stripURL(f.fields[k][l])}g.parents={};for(var m in i.parents)f.fields[m]&&(g.parents[m]=a.stripURL(f.fields[m]));g.data={};for(var n in i.data)f.fields[n]&&(g.data[n]=f.fields[n])}c[g.id]=g}return c},b.prototype.adaptUpdate=function(b){var c={},d,e=null,f=null,g="";b.type&&a.modelCategory(b.type)&&(e=b.type,f=a.modelCategory(b.type));if(b.id){var h=b.id.split("/");if(h.length==1)g=b.id;else if(h.length==3)g=h[2],!e&&!f&&(f=h[0],e=h[1]);else throw new Error("data has an invalid id: "+g)}d=[f,e,g].join("/"),d[0]!=="/"&&(d="/"+d),objMerge(b,c,!0,["id","type","category","plotable","date_created","owner","safety_level","name","fields","parents","data","children"]),e==="value"?c.name=b.data:c.name=b.name,c.safety_level=b.safety_level||"private";switch(c.safety_level){case"public":c.safety_level=1;break;case"friendly":c.safety_level=2;break;default:c.safety_level=3}c=objMerge(b.fields,c),c=objMerge(b.data,c);for(var i in b.parents)if(b.parents[i]){var h=b.parents[i].split("/");c[i]=h[h.length-1]}return{data:c,url:d}},b}()})(wdat||(wdat={}));