{% extends "test/test_base.html" %}

{% block title %}Form Test{% endblock %}

{% block extra_script %}
<script type="text/javascript">
  var init = function() {
    var bus = new WDAT.Bus();
    var api = new WDAT.DataAPI('NetworkResource', 'ResourceAdapter', bus);
    /* Create test form with the VForm base class */
    var fields = {
      'id': {type: 'hidden', value: '1'},
      'your-name': {type: 'text', min: 3, max: 10, obligatory: true},
      'your-age': {type: 'int', value: 10, readonly: true},
      'your-password': {type: 'password', min: 4, max: 12, obligatory: true},
      'day-of-birth': {type: 'date', obligatory: true},
      'satisfied': {type: 'boolean'},
      'vavorite-pizza' : {type: 'option', options: { funghi: "Pizza Funghi", salami: "Pizza Salami", vegi: "Vegi Pizza"}},
      'text': {type: 'ltext'}
    };
    var form = new WDAT.Form($('#form01'), bus, ['save'], fields);
    form.set({});
    /* create and register handler for save events */
    function doSave(event, data) {
      console.log('EVENT save: ' + JSON.stringify(data));
    }
    bus.subscribe(form.event('save'), doSave);

    var form_section = new WDAT.Form('form-section', bus, ['save'], 'section', true);
    var btn_section  = $("#btn-section").button({text: true});
    btn_section.click( function() {
      var id = $('#input-section').val();
      console.log('REQUEST section: ' + id);
      api.get('get-section', {"id": id, "type": "section"});
    });
    function doGetSection(event, data) {
      console.log('EVENT get-section: ' + JSON.stringify(data));
      form_section.set(data.response[0]);
      form_section.open();
    }
    bus.subscribe('get-section', doGetSection);

    var form_property = new WDAT.Form('form-property', bus, ['save'], 'property', true);
    var btn_property  = $("#btn-property").button({text: true});
    btn_property.click( function() {
      var id = $('#input-property').val();
      console.log('REQUEST property: ' + id);
      api.get('get-property', {"id": id, "type": "property"});
    });
    function doGetProperty(event, data) {
      console.log('EVENT get-property: ' + JSON.stringify(data));
      form_property.set(data.response[0]);
      form_property.open();
    }
    bus.subscribe('get-property', doGetProperty);
  };
  $(window).load(init);
</script>
{% endblock %}

{% block body %}
<h1>Form Test</h1>
<div>
  <div id="form01" style="border: 1px solid grey"></div>
</div>
<div>
  <button id="btn-section">Show Section</button>
  <span>/metadata/section/</span>
  <input type="text" value="1" id="input-section">
</div>
<div>
  <button id="btn-property">Show Property</button>
  <span>/metadata/property/</span>
  <input type="text" value="1" id="input-property">
</div>
<div class="event-log">
</div>
{% endblock %}
